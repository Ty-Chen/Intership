# 关于文档编码格式造成的困扰

## 简介

  最近在写代码中涉及到编译器的编码格式以及文档的编码格式问题，因为两种编码格式的巨大差别，在开发过程中造成了一定的困扰，故在这里做个记录。

## 问题分析

  因为自己的编译器的默认编码格式为GBK，而客户端以及服务端产生的日志编码格式是ANSI，GBK是ANSI的扩展，所以可以对日志文档中的中文进行查询，而查询的结果输出到文档时文档的格式也变成了ANSI。但是grep并不支持对ANSI编码格式文档的中文查询，只支持对UTF-8编码模式下的文档进行中文查询。如图：

![img](file:///C:\Users\admin\AppData\Local\Temp\ksohtml\wps_clip_image-11380.png)



![img](file:///C:\Users\admin\AppData\Local\Temp\ksohtml\wps_clip_image-14397.png)

![img](file:///C:\Users\admin\AppData\Local\Temp\ksohtml\wps_clip_image-7479.png)

E:\\Log里面的日志文件都是ANSI的编码格式，无法搜索，而中文.txt是自定义的UTF-8文档，所以能搜索中文。

在执行grep的时候还会出现一个问题，就是输出到文档的数据不完整的问题，文档的最后总会有 binary file matches 的问题，查阅资料发现 grep 认为该文本是二进制文件，然后改变了命令得以解决：

![img](file:///C:\Users\admin\AppData\Local\Temp\ksohtml\wps_clip_image-187.png)

但是又出现了新的问题：grep匹配的结果集与我自己匹配的结果集文档总是差一两个字节，都是\n\r的缺少问题。比较苦恼。

## 问题解决方案

最后因为grep或多或少的问题并且无法搜索中文，尝试了windows下的findstr命令，该命令与grep差不多，也是对文本字符串的搜索，并且能够搜索中文，但是这个命令会有一个问题：如果文本的最后一行没有换行符，那么输出到目标文本也是没有换行符的，这就造成数据丢失。当然如果匹配到的字符没有所处最后一行，那么匹配结果与自己程序所匹配到的结果吻合。

## 问题总结

最终该问题还是没能完全解决，在没有找到更好的解决方案之前，使用grep搜索尽量不要搜索中文了。