# CPU时间与挂钟时间

## 简介

在Linux下用time计算了多线程程序所耗费的时间，发现Real > user + sys ,有点奇怪，查询得知这是CPU时间与挂钟时间的区别。

## 问题分析

所谓挂钟时间指程序从开始执行到结束运行的所耗费的实际时间，CPU时间即反映CPU全速工作时完成该进程所花费的时间。单线程程序下如果不算进程堵塞时间，这两者的时间几乎相等。但是在多核CPU多线程程序下这种情况又不一定。

在单核CPU执行多线程程序时，CPU会把运行时间划分成若干个时间片，分配给各个线程执行，在一个时间段的线程代码运行时，其他线程处于挂起状态。所以CPU时间会约等于挂钟时间。但是，在多核CPU里面，每个线程都在单独的核里面运行，所以总的CPU时间为每个内核的CPU时间相加。这就是为什么有时候多线程程序CPU时间会大于挂钟时间。

其中挂钟时间与 CPU时间有如下简要关系

Real < CPU，表明进程为计算密集型(CPU bound)，利用多核处理器的并行执行优势；
Real ≈ CPU，表明进程为计算密集型(CPU bound)，未并行执行；
Real > CPU，表明进程为I/O密集型(I/O bound)，多核并行执行优势并不明显。

在单核处理器上，Real时间和CPU时间之差，即Real- (User + Sys)是所有延迟程序执行的因素的总和。可估算程序运行期间的CPU利用率为CpuUsage = (User + Sys)/ Real * 100(%)。

## 问题总结

关于程序运行的时间要具体问题具体分析，切不能混淆。

关于线程数量多少合适，这与CPU内核以及运行的程序都有关，留到下次再记录了。



